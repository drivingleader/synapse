<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Traffic Master - Listato 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* App Sections */
        .app-section { display: none; height: 100%; width: 100%; flex-direction: column; }
        .app-section.active { display: flex; }

        /* Menu Card */
        .menu-card { transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); cursor: pointer; position: relative; overflow: hidden; }
        .menu-card:active { transform: scale(0.96); }

        /* Quiz Hacker Styles */
        .highlight-text { color: #ffffff; font-weight: 900; line-height: 1.3; text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); font-size: 1.25rem; display: block; margin: 0.5rem 0; }
        .dimmed-text { opacity: 0.5; font-size: 0.9rem; }
        .prefix-text { color: #94a3b8; font-size: 0.9rem; margin-bottom: 4px; display: block; }
        
        /* Code Breaker Styles */
        .breaker-font { font-family: 'JetBrains Mono', monospace; color: #00ff41; background-color: #050505; }
        .slot { border-bottom: 2px solid #333; width: 28px; height: 40px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; font-weight: bold; margin: 2px; }
        .slot.filled { color: white; border-color: white; }
        .slot.correct { color: #00ff41; border-color: #00ff41; background: rgba(0, 255, 65, 0.1); }
        .key-btn { background: #111; border: 1px solid #333; color: white; border-radius: 6px; font-weight: bold; padding: 10px 0; touch-action: manipulation; }
        .key-btn:active { transform: translateY(2px); }

        /* Icons & Visuals */
        .category-icon { width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; border-radius: 12px; font-size: 24px; margin-bottom: 10px; }
        .icon-danger { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444; }
        .icon-prohibition { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 2px solid #ef4444; border-radius: 50%; }
        .icon-obligation { background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 2px solid #3b82f6; border-radius: 50%; }
        .icon-theory { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid #10b981; }

        /* Animations */
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .card-enter { animation: slideIn 0.3s ease-out; }
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body>

    <!-- 1. MAIN MENU -->
    <div id="main-menu" class="app-section active p-6 items-center justify-center bg-slate-900 relative">
        <div class="text-center mb-10 z-10">
            <h1 class="text-4xl font-black mb-2 tracking-tighter text-white">TRAFFIC<span class="text-blue-500">MASTER</span></h1>
            <p class="text-slate-400 text-xs uppercase tracking-widest font-bold">Listato Ufficiale 2026</p>
            <div class="mt-2 text-[10px] text-slate-500" id="total-count-display">Caricamento DB...</div>
        </div>

        <div class="w-full max-w-sm space-y-5 z-10">
            <!-- Quiz Hacker Btn -->
            <div onclick="switchApp('hacker')" class="menu-card bg-slate-800 rounded-3xl p-6 border-2 border-slate-700 hover:border-blue-500 group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fas fa-bolt text-8xl text-blue-500"></i>
                </div>
                <div class="flex items-center gap-4 mb-3">
                    <div class="bg-blue-600 w-12 h-12 rounded-2xl flex items-center justify-center text-white text-xl shadow-lg shadow-blue-500/30">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Quiz Hacker</h2>
                        <span class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">Rapid Fire</span>
                    </div>
                </div>
                <p class="text-slate-400 text-sm leading-snug">Allena i riflessi. Vero o Falso istantaneo sulle domande ufficiali.</p>
            </div>

            <!-- Code Breaker Btn -->
            <div onclick="switchApp('breaker')" class="menu-card bg-black rounded-3xl p-6 border-2 border-green-900 hover:border-green-500 group shadow-lg shadow-green-900/20">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fas fa-terminal text-8xl text-green-500"></i>
                </div>
                <div class="flex items-center gap-4 mb-3">
                    <div class="bg-green-600 w-12 h-12 rounded-2xl flex items-center justify-center text-black text-xl shadow-lg shadow-green-500/30">
                        <i class="fas fa-keyboard"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-green-400" style="font-family: 'JetBrains Mono'">Code Breaker</h2>
                        <span class="text-[10px] font-bold text-green-600 uppercase tracking-widest font-mono">Decrypt</span>
                    </div>
                </div>
                <p class="text-slate-500 text-sm leading-snug font-mono">Completa le parole mancanti nelle frasi del codice della strada.</p>
            </div>
        </div>
    </div>

    <!-- 2. QUIZ HACKER APP -->
    <div id="app-hacker" class="app-section p-4 max-w-md mx-auto relative bg-slate-900">
        <!-- Header -->
        <div class="w-full flex justify-between items-center h-[60px]">
            <button onclick="switchApp('menu')" class="text-slate-400 hover:text-white px-3 py-2 bg-slate-800 rounded-xl text-xs font-bold border border-slate-700">
                <i class="fas fa-arrow-left mr-1"></i> MENU
            </button>
            <div class="flex gap-1 text-red-500 text-lg" id="qh-lives">
                <i class="fas fa-heart"></i><i class="fas fa-heart"></i><i class="fas fa-heart"></i>
            </div>
        </div>

        <!-- Card -->
        <div class="flex-1 flex flex-col justify-center relative">
            <div id="qh-card" class="bg-slate-800 w-full rounded-3xl p-6 shadow-2xl border-t border-slate-700 flex flex-col items-center justify-between min-h-[400px]">
                
                <div class="w-full flex justify-between items-start mb-4">
                    <div id="qh-topic" class="text-[10px] font-bold uppercase tracking-widest text-blue-400 bg-blue-400/10 px-2 py-1 rounded">ARGOMENTO</div>
                </div>

                <!-- Visual Icon (Category Based) -->
                <div id="qh-icon" class="category-icon icon-theory">
                    <i class="fas fa-book"></i>
                </div>

                <!-- Question Text -->
                <div id="qh-text-container" class="text-center w-full break-words flex-1 flex flex-col justify-center my-4">
                    <!-- Text injected via JS -->
                </div>

                <!-- Progress Bar -->
                <div class="w-full">
                    <div class="flex justify-between text-[10px] text-slate-500 mb-1 font-bold uppercase">
                        <span>Score: <span id="qh-score" class="text-white">0</span></span>
                        <span>Streak: <span id="qh-streak" class="text-yellow-400">0</span></span>
                    </div>
                    <div class="w-full h-1.5 bg-slate-700 rounded-full overflow-hidden">
                        <div id="qh-bar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                    </div>
                </div>
            </div>
            
            <!-- Feedback Overlay -->
            <div id="qh-feedback" class="absolute inset-0 hidden items-center justify-center z-50 rounded-3xl backdrop-blur-sm bg-black/50 pointer-events-none">
                <div id="qh-feedback-icon" class="text-8xl transform scale-0 transition-transform duration-200 drop-shadow-2xl"></div>
            </div>
        </div>

        <!-- Controls -->
        <div class="w-full mt-4 grid grid-cols-2 gap-4 h-[100px]">
            <button onclick="qh_answer(false)" class="bg-slate-800 border-b-4 border-red-900 text-red-500 rounded-2xl font-black text-2xl active:border-b-0 active:translate-y-1 transition-all hover:bg-slate-750">FALSO</button>
            <button onclick="qh_answer(true)" class="bg-slate-800 border-b-4 border-green-900 text-green-500 rounded-2xl font-black text-2xl active:border-b-0 active:translate-y-1 transition-all hover:bg-slate-750">VERO</button>
        </div>
    </div>

    <!-- 3. CODE BREAKER APP -->
    <div id="app-breaker" class="app-section breaker-font flex-col p-4 max-w-md mx-auto relative bg-black">
        <!-- Header -->
        <div class="flex justify-between items-center h-[50px] mb-2">
            <button onclick="switchApp('menu')" class="text-green-700 hover:text-green-500 px-3 py-1 border border-green-900 rounded text-xs font-bold">
                ESC
            </button>
            <div class="text-xs text-green-800 font-bold">LIVELLO <span id="cb-lvl" class="text-green-500">1</span></div>
        </div>

        <!-- Game Area -->
        <div class="flex-1 flex flex-col relative">
            <div class="flex-1 flex flex-col justify-center items-center text-center">
                
                <div id="cb-topic" class="text-[10px] text-green-800 border border-green-900 px-2 py-1 rounded mb-6 uppercase tracking-widest">TOPIC</div>
                
                <div id="cb-question-text" class="text-slate-400 text-sm md:text-base leading-relaxed mb-6 font-sans">
                    <!-- Injected JS -->
                </div>

                <div id="cb-slots" class="flex flex-wrap justify-center gap-1 mb-8">
                    <!-- Slots injected JS -->
                </div>
            </div>

            <!-- Keyboard -->
            <div class="w-full pb-4">
                <div class="text-center text-[10px] text-green-900 mb-2 uppercase tracking-widest font-bold">Decripta la parola mancante</div>
                <div id="cb-keys" class="grid grid-cols-7 gap-1">
                    <!-- Keys injected JS -->
                </div>
                <div class="flex gap-2 mt-3">
                    <button onclick="cb_delete()" class="flex-1 py-3 bg-slate-900 rounded border border-slate-800 text-red-500 active:bg-slate-800 font-bold"><i class="fas fa-backspace"></i></button>
                    <button onclick="cb_check()" class="flex-[2] py-3 bg-green-900/20 text-green-400 border border-green-600 rounded font-bold hover:bg-green-900/40 active:scale-95 transition-all">ENTER</button>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGICA JAVASCRIPT -->
    <script>
        // --- 1. PARSER DEL FILE ALLEGATO ---
        // Simulo il caricamento del file testuale. In produzione questo stringa verrebbe dal file reale.
        // Qui inserisco un campione significativo basato sulla struttura del file "Analisi Listato A B 2026"
        const rawData = `
Lezione: 01.1 Definizioni stradali e di traffico
Argomento: La strada
La strada è...
[ F ] ...riservata alla circolazione dei soli autoveicoli e motocicli
[ V ] ...aperta alla circolazione dei pedoni, degli animali e dei veicoli
[ F ] ...qualsiasi area asfaltata, limitata lateralmente dagli attraversamenti pedonali
La strada può...
[ V ] ...comprendere le piste ciclabili
[ V ] ...essere suddivisa in carreggiate
[ V ] ...essere a doppio senso di circolazione
[ V ] ...essere a senso unico di circolazione
La strada non comprende...
[ F ] ...i marciapiedi
[ F ] ...le banchine
Argomento: La carreggiata
La carreggiata è...
[ F ] ...destinata soltanto alla circolazione di carri a trazione animale
[ V ] ...la parte della strada destinata normalmente alla circolazione dei veicoli
[ F ] ...destinata alla sosta degli autocarri
[ F ] ...la traccia lasciata dalle ruote dei veicoli sulle strade innevate
[ F ] ...destinata alla sosta di emergenza
La carreggiata può...
[ V ] ...essere a senso unico di circolazione
[ V ] ...essere suddivisa in corsie
[ V ] ...essere a doppio senso di circolazione
Fanno parte della carreggiata...
[ V ] ...le corsie di sorpasso
[ V ] ...le corsie di marcia
[ V ] ...gli attraversamenti pedonali
[ V ] ...gli attraversamenti ciclabili
Non fanno parte della carreggiata...
[ V ] ...le banchine
[ V ] ...i marciapiedi
[ V ] ...le piste ciclabili
[ V ] ...le piazzole di sosta
Le corsie...
[ V ] ...possono essere vietate a taluni tipi di veicoli
[ V ] ...possono essere destinate alla normale marcia dei veicoli
[ V ] ...possono essere destinate ai rallentamenti dei veicoli in uscita dalle autostrade
[ V ] ...possono essere riservate alla circolazione di alcune categorie di veicoli (taxi, autobus, ecc.)
[ V ] ...possono essere destinate alle accelerazioni dei veicoli in entrata nelle autostrade
[ V ] ...possono essere destinate al sorpasso
[ F ] ...possono essere a doppio senso di circolazione
[ F ] ...sono sempre delimitate da strisce continue
[ F ] ...formano la carreggiata solo se sono più di due
Argomento: Segnaletica
Il segnale raffigurato preannuncia...
[ V ] ...un tratto di strada deformata
[ V ] ...una strada in cattivo stato
[ V ] ...una variazione di pendenza
[ V ] ...un dosso artificiale
[ V ] ...una curva pericolosa a destra
[ V ] ...un passaggio a livello senza barriere
[ F ] ...un divieto di sosta
[ F ] ...un senso unico alternato
Il segnale raffigurato vieta...
[ V ] ...il transito a tutti i veicoli
[ V ] ...il sorpasso
[ V ] ...la sosta
[ V ] ...l'accesso
[ F ] ...la fermata
[ F ] ...di svoltare a destra
Argomento: Norme di Comportamento
Il conducente deve...
[ V ] ...regolare la velocità in relazione alle condizioni della strada
[ V ] ...dare la precedenza a destra negli incroci non regolati
[ V ] ...usare il casco se guida un motociclo
[ V ] ...fermarsi al semaforo rosso
[ F ] ...passare per primo sempre
[ F ] ...suonare il clacson in centro abitato
È vietato...
[ V ] ...sorpassare in curva
[ V ] ...invertire la marcia in autostrada
[ V ] ...guidare dopo aver assunto alcol
[ V ] ...gareggiare in velocità
[ F ] ...sorpassare di notte
[ F ] ...guidare con gli occhiali da sole
Argomento: Veicoli
I ciclomotori...
[ V ] ...hanno cilindrata fino a 50 cm3
[ V ] ...sviluppano una velocità massima di 45 km/h
[ F ] ...possono circolare in autostrada
[ F ] ...non hanno bisogno di assicurazione
La patente B...
[ V ] ...abilita a guidare le autovetture
[ V ] ...vale 10 anni fino ai 50 anni di età
[ F ] ...abilita a guidare gli autobus
`;

        // --- DATABASE STORAGE ---
        let fullDB = [];
        let breakerDB = []; // Per il gioco "Code Breaker"

        function parseData() {
            const lines = rawData.split('\n');
            let topic = "Generale";
            let prefix = "";
            let newDB = [];
            let newBreaker = [];

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                // Detection
                if (line.startsWith("Argomento:")) {
                    topic = line.replace("Argomento:", "").trim();
                    return;
                }
                if (line.startsWith("Lezione:")) return;

                if (line.startsWith("[ V ]") || line.startsWith("[ F ]")) {
                    const isTrue = line.startsWith("[ V ]");
                    let suffix = line.substring(5).trim();
                    if (suffix.startsWith("...")) suffix = suffix.substring(3).trim();
                    let cleanPrefix = prefix.endsWith("...") ? prefix.slice(0, -3).trim() : prefix;

                    // Add to Quiz Hacker DB
                    newDB.push({
                        text: `${cleanPrefix} ${suffix}`,
                        prefix: cleanPrefix,
                        suffix: suffix,
                        isTrue: isTrue,
                        topic: topic
                    });

                    // Add to Code Breaker DB (Solo se Vero e ha lunghezza adeguata)
                    if (isTrue && suffix.split(' ').length > 1 && suffix.length < 30) {
                        // Cerchiamo una parola chiave nel suffisso da nascondere
                        const words = suffix.split(' ');
                        const targetWord = words.sort((a,b) => b.length - a.length)[0].toUpperCase().replace(/[^A-Z]/g, ''); // Parola più lunga
                        
                        if (targetWord.length > 3) {
                            newBreaker.push({
                                pre: cleanPrefix,
                                word: targetWord,
                                post: suffix.replace(new RegExp(targetWord, 'i'), "_____"), // Sostituzione grezza per visual
                                fullSuffix: suffix,
                                topic: topic
                            });
                        }
                    }

                } else {
                    prefix = line;
                }
            });

            // Expand DB for demo purpose (In production this would be just fullDB = newDB)
            // Moltiplichiamo i dati per simulare la massa
            for(let i=0; i<20; i++) {
                newDB.forEach(item => fullDB.push({...item}));
                newBreaker.forEach(item => breakerDB.push({...item}));
            }
            
            // Shuffle
            fullDB.sort(() => Math.random() - 0.5);
            breakerDB.sort(() => Math.random() - 0.5);

            document.getElementById('total-count-display').innerText = `Database: ${fullDB.length} Quiz Attivi`;
        }

        function switchApp(app) {
            document.querySelectorAll('.app-section').forEach(el => el.classList.remove('active'));
            if(app === 'menu') document.getElementById('main-menu').classList.add('active');
            if(app === 'hacker') { document.getElementById('app-hacker').classList.add('active'); initHacker(); }
            if(app === 'breaker') { document.getElementById('app-breaker').classList.add('active'); initBreaker(); }
        }

        // ================= APP 1: QUIZ HACKER =================
        let qh_pool = [];
        let qh_current = null;
        let qh_score = 0;
        let qh_streak = 0;
        let qh_lives = 3;

        function initHacker() {
            qh_pool = [...fullDB].sort(() => Math.random() - 0.5);
            qh_lives = 3;
            qh_score = 0;
            qh_streak = 0;
            updateHackerUI();
            nextHackerCard();
        }

        function nextHackerCard() {
            if(qh_pool.length === 0) qh_pool = [...fullDB]; // Refill
            qh_current = qh_pool.pop();
            
            // Reset Animation
            const card = document.getElementById('qh-card');
            card.classList.remove('card-enter', 'shake');
            void card.offsetWidth; card.classList.add('card-enter');

            // Set Data
            document.getElementById('qh-topic').innerText = qh_current.topic;
            
            // Set Icon based on Topic/Text
            const iconBox = document.getElementById('qh-icon');
            let iconClass = 'icon-theory';
            let faIcon = 'fa-book';
            
            const txt = qh_current.text.toLowerCase();
            if(txt.includes('pericolo') || txt.includes('preannuncia')) { iconClass = 'icon-danger'; faIcon = 'fa-triangle-exclamation'; }
            else if(txt.includes('vieta') || txt.includes('divieto')) { iconClass = 'icon-prohibition'; faIcon = 'fa-ban'; }
            else if(txt.includes('obblig')) { iconClass = 'icon-obligation'; faIcon = 'fa-circle-exclamation'; }
            
            iconBox.className = `category-icon ${iconClass}`;
            iconBox.innerHTML = `<i class="fas ${faIcon}"></i>`;

            // Set Text with Highlight
            document.getElementById('qh-text-container').innerHTML = `
                <span class="prefix-text">${qh_current.prefix}</span>
                <span class="highlight-text">${qh_current.suffix}</span>
            `;
        }

        function qh_answer(userChoice) {
            const isCorrect = (userChoice === qh_current.isTrue);
            
            // Visual Feedback
            const feedback = document.getElementById('qh-feedback');
            const fbIcon = document.getElementById('qh-feedback-icon');
            feedback.classList.remove('hidden');
            feedback.classList.add('flex');
            
            if(isCorrect) {
                fbIcon.innerHTML = '<i class="fas fa-check text-green-500"></i>';
                qh_score += 10 + qh_streak;
                qh_streak++;
            } else {
                fbIcon.innerHTML = '<i class="fas fa-times text-red-500"></i>';
                qh_lives--;
                qh_streak = 0;
                document.getElementById('qh-card').classList.add('shake');
            }
            
            fbIcon.className = "text-8xl transform scale-150 transition-transform duration-200";
            updateHackerUI();

            setTimeout(() => {
                feedback.classList.add('hidden');
                feedback.classList.remove('flex');
                fbIcon.classList.remove('scale-150');
                
                if(qh_lives <= 0) {
                    alert(`GAME OVER! Punti: ${qh_score}`);
                    switchApp('menu');
                } else {
                    nextHackerCard();
                }
            }, 600);
        }

        function updateHackerUI() {
            document.getElementById('qh-score').innerText = qh_score;
            document.getElementById('qh-streak').innerText = qh_streak;
            let livesHTML = '';
            for(let i=0; i<3; i++) {
                livesHTML += i < qh_lives ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart opacity-30"></i>';
            }
            document.getElementById('qh-lives').innerHTML = livesHTML;
        }

        // ================= APP 2: CODE BREAKER =================
        let cb_pool = [];
        let cb_current = null;
        let cb_user_input = [];
        let cb_level = 1;

        function initBreaker() {
            cb_pool = [...breakerDB].sort(() => Math.random() - 0.5);
            cb_level = 1;
            loadBreakerLevel();
        }

        function loadBreakerLevel() {
            if(cb_pool.length === 0) cb_pool = [...breakerDB]; // Refill
            cb_current = cb_pool.pop();
            cb_user_input = Array(cb_current.word.length).fill('');
            
            document.getElementById('cb-lvl').innerText = cb_level;
            document.getElementById('cb-topic').innerText = cb_current.topic;
            
            // Set Question Text (Masked)
            // Replace the keyword in the suffix with a gap
            const displaySuffix = cb_current.fullSuffix.replace(new RegExp(cb_current.word, 'i'), '<span class="text-green-500 font-bold">[ ... ]</span>');
            
            document.getElementById('cb-question-text').innerHTML = `
                <span class="text-slate-500">${cb_current.pre}</span><br>
                <span class="text-white text-lg">${displaySuffix}</span>
            `;

            // Render Slots
            const slotsContainer = document.getElementById('cb-slots');
            slotsContainer.innerHTML = '';
            for(let i=0; i<cb_current.word.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.id = `slot-${i}`;
                slotsContainer.appendChild(slot);
            }
            highlightSlot(0);

            // Render Keyboard (Target letters + Noise)
            const kbContainer = document.getElementById('cb-keys');
            kbContainer.innerHTML = '';
            let pool = cb_current.word.split('');
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for(let i=0; i<4; i++) pool.push(alphabet[Math.floor(Math.random() * alphabet.length)]);
            pool.sort(() => Math.random() - 0.5);
            
            pool.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'key-btn text-green-400 border-green-900';
                btn.innerText = char;
                btn.onclick = () => typeChar(char);
                kbContainer.appendChild(btn);
            });
        }

        function typeChar(char) {
            const idx = cb_user_input.findIndex(c => c === '');
            if(idx !== -1) {
                cb_user_input[idx] = char;
                const s = document.getElementById(`slot-${idx}`);
                s.innerText = char;
                s.classList.add('filled');
                highlightSlot(idx+1);
            }
        }

        function cb_delete() {
            let idx = -1;
            for(let i = cb_user_input.length - 1; i >= 0; i--) {
                if(cb_user_input[i] !== '') { idx = i; break; }
            }
            if(idx !== -1) {
                cb_user_input[idx] = '';
                const s = document.getElementById(`slot-${idx}`);
                s.innerText = '';
                s.classList.remove('filled', 'wrong');
                highlightSlot(idx);
            }
        }

        function highlightSlot(idx) {
            document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
            const el = document.getElementById(`slot-${idx}`);
            if(el) el.classList.add('active');
        }

        function cb_check() {
            const attempt = cb_user_input.join('');
            const slots = document.getElementById('cb-slots');
            
            if(attempt === cb_current.word) {
                document.querySelectorAll('.slot').forEach(s => s.classList.add('correct'));
                setTimeout(() => {
                    cb_level++;
                    loadBreakerLevel();
                }, 1000);
            } else {
                slots.classList.add('shake');
                document.querySelectorAll('.slot').forEach(s => s.classList.add('wrong'));
                setTimeout(() => {
                    slots.classList.remove('shake');
                    document.querySelectorAll('.slot').forEach(s => s.classList.remove('wrong'));
                }, 500);
            }
        }

        // Init
        parseData();

    </script>
</body>
</html>
