<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Quiz Hacker - Official Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* Reset e Base per Mobile */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: white;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            height: 100dvh; /* Dynamic Viewport Height per mobile */
        }

        .gradient-text {
            background: linear-gradient(to right, #4ade80, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Animazioni */
        .card-enter { animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .btn-press { transition: transform 0.05s, background-color 0.2s; }
        .btn-press:active { transform: scale(0.96); }

        /* Typography Responsive */
        .dimmed-text { opacity: 0.5; font-size: 0.85rem; font-weight: 400; margin-bottom: 0.2rem; }
        .highlight-text { color: #ffffff; font-weight: 900; line-height: 1.2; text-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        
        @media (max-height: 700px) {
            .highlight-text { font-size: 1.1rem; }
            #sign-visual-container { height: 100px !important; }
            #card { padding: 1rem; }
        }
        @media (min-height: 701px) {
            .highlight-text { font-size: 1.4rem; }
        }

        .boss-mode { border: 2px solid #ef4444; box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); }
        
        /* Progress Bar */
        .progress-container { width: 100%; height: 4px; background: #1e293b; border-radius: 99px; margin-top: auto; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #4ade80, #3b82f6); transition: width 0.3s ease; }
        
        /* Image Styling */
        .ministerial-img {
            max-height: 100%;
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 2px solid #334155;
            object-fit: contain;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-between p-4 max-w-md mx-auto h-full relative">

    <!-- Header Stats -->
    <div class="w-full flex justify-between items-center z-10 pt-2 h-[50px] shrink-0">
        <div class="flex flex-col">
            <span class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Combo</span>
            <span id="combo-display" class="text-2xl font-black text-yellow-400 leading-none">x0</span>
        </div>
        
        <div id="mini-logo" class="hidden text-sm font-black tracking-widest text-slate-600">QUIZ HACKER</div>

        <div class="flex flex-col items-end">
            <span class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Vite</span>
            <div id="lives-display" class="flex space-x-1 text-red-500 text-lg">
                <i class="fas fa-heart"></i><i class="fas fa-heart"></i><i class="fas fa-heart"></i>
            </div>
        </div>
    </div>

    <!-- Main Card Area -->
    <div id="quiz-container" class="flex-1 w-full flex flex-col justify-center relative my-2 min-h-0">
        
        <!-- Start Screen -->
        <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-800 rounded-3xl p-6 text-center z-50 shadow-2xl border border-slate-700">
            <div class="mb-6">
                <i class="fas fa-brain text-5xl text-blue-500 mb-4 animate-bounce"></i>
                <h1 class="text-4xl font-black mb-1 leading-none"><span class="gradient-text">QUIZ<br>HACKER</span></h1>
                <h2 class="text-xs font-bold text-slate-500 tracking-[0.2em] mt-2">OFFICIAL IMAGES</h2>
            </div>
            
            <div class="bg-slate-900/50 p-4 rounded-xl mb-6 w-full border border-slate-700 backdrop-blur-sm">
                <div class="flex justify-between text-xs text-slate-400 mb-2 uppercase">
                    <span>Database</span>
                    <span class="text-white font-bold">Ministeriale 2025</span>
                </div>
                <div class="flex justify-between text-xs text-slate-400 uppercase border-t border-slate-700 pt-2">
                    <span>Metodo</span>
                    <span class="text-green-400 font-bold">80/20 & Immagini Reali</span>
                </div>
            </div>

            <div class="space-y-3 w-full">
                <button onclick="startGame('mix')" class="w-full py-4 bg-blue-600 hover:bg-blue-500 active:bg-blue-700 rounded-2xl font-bold text-lg shadow-lg shadow-blue-900/50 btn-press flex items-center justify-center gap-3">
                    <i class="fas fa-rocket"></i> Inizia
                </button>
            </div>
        </div>

        <!-- Question Card -->
        <div id="card" class="bg-slate-800 w-full rounded-3xl p-6 shadow-2xl border-t border-slate-700 hidden flex flex-col items-center justify-between h-full max-h-[550px]">
            
            <!-- Badges -->
            <div class="w-full flex justify-between items-start mb-2 h-6">
                 <div id="boss-badge" class="hidden bg-red-600 text-white text-[9px] font-bold px-2 py-1 rounded mb-2 uppercase tracking-widest shadow-red-900/50 shadow-lg inline-block">
                    <i class="fas fa-skull"></i> Difficile
                </div>
                <div id="fig-badge" class="bg-slate-700 text-slate-300 text-[9px] font-bold px-2 py-1 rounded mb-2 uppercase tracking-widest border border-slate-600 inline-block">
                    <!-- Figura ID injected here -->
                </div>
            </div>

            <!-- Image Container -->
            <div id="sign-visual-container" class="w-full flex justify-center items-center h-32 mb-4 bg-slate-900/50 rounded-xl p-2 border border-slate-700/50">
                <!-- Image injected via JS -->
            </div>

            <!-- Text -->
            <div id="question-text" class="text-center w-full break-words flex-1 flex flex-col justify-center">
                <!-- Content injected via JS -->
            </div>
            
            <!-- Footer Progress -->
            <div class="w-full mt-4">
                 <div class="flex justify-between text-[10px] text-slate-500 uppercase mb-1 font-bold">
                    <span>Livello</span>
                    <span id="progress-text">1</span>
                </div>
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Feedback Overlay -->
        <div id="feedback" class="absolute inset-0 hidden items-center justify-center z-40 rounded-3xl backdrop-blur-md bg-black/60 pointer-events-none">
            <div id="feedback-icon" class="text-9xl transform scale-0 transition-transform duration-200 drop-shadow-2xl"></div>
        </div>

    </div>

    <!-- Controls (Bottom) -->
    <div id="controls" class="w-full mt-2 mb-safe grid grid-cols-2 gap-3 hidden h-[140px] shrink-0">
        <button id="btn-false" onclick="handleAnswer(false)" class="h-full bg-slate-800 border-b-4 border-red-900 text-red-500 rounded-2xl font-black text-2xl active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center justify-center group touch-none select-none outline-none">
            <i class="fas fa-times text-3xl mb-1 group-active:scale-90 transition-transform"></i>
            <span>FALSO</span>
        </button>
        <button id="btn-true" onclick="handleAnswer(true)" class="h-full bg-slate-800 border-b-4 border-green-900 text-green-500 rounded-2xl font-black text-2xl active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center justify-center group touch-none select-none outline-none">
            <i class="fas fa-check text-3xl mb-1 group-active:scale-90 transition-transform"></i>
            <span>VERO</span>
        </button>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over" class="hidden absolute inset-0 bg-slate-900 z-50 flex flex-col items-center justify-center p-8 text-center">
        <div class="text-6xl mb-4 animate-bounce">üèÜ</div>
        <h2 class="text-3xl font-bold text-white mb-2">FINE PARTITA</h2>
        <div class="bg-slate-800 p-6 rounded-2xl w-full mb-8 border border-slate-700">
             <div class="flex justify-between text-slate-400 mb-2">
                <span>Risposte</span>
                <span id="final-count" class="text-white font-bold">0</span>
            </div>
            <div class="flex justify-between text-slate-400 border-t border-slate-700 pt-2">
                <span>Punteggio</span>
                <span id="final-score" class="text-yellow-400 font-bold text-xl">0</span>
            </div>
        </div>
       
        <button onclick="resetGame()" class="w-full py-4 bg-white text-slate-900 rounded-xl font-bold btn-press text-lg shadow-xl">Rigioca Subito</button>
    </div>

    <script>
        // --- REAL DATABASE (With Official Figure IDs) ---
        // Extracted from your PDF + Standard Signals for variety
        const database = [
            // --- VEICOLI (Figura 1) - Extracted from PDF ---
            { "text": "I veicoli a due ruote, con motore termico fino a 50 cm3 di cilindrata e velocit√† massima di 45 km/h sono ciclomotori", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "MOTORE FINO A 50 cm3 = CICLOMOTORI", "id": "q_0" },
            { "text": "I ciclomotori possono avere due o tre ruote", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "CICLOMOTORI possono avere 2 o 3 RUOTE", "id": "q_1" },
            { "text": "I ciclomotori a due ruote non possono avere un motore termico di cilindrata superiore a 50 cm3", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "NON SUPERIORE A 50 cm3", "id": "q_3" },
            { "text": "I ciclomotori sono soggetti a revisione dopo quattro anni dalla prima immatricolazione", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "REVISIONE dopo 4 ANNI", "id": "q_4" },
            { "text": "I motocicli sono veicoli a due ruote di cilindrata superiore a 50 cm3", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "MOTOCICLI > 50 cm3", "id": "q_12" },
            { "text": "I quadricicli leggeri sono equiparati ai ciclomotori", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "QUADRICICLI LEGGERI = CICLOMOTORI", "id": "q_32" },
            { "text": "La potenza dei quadricicli non leggeri √® sempre inferiore o uguale a 15 kW", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "POTENZA MAX 15 kW", "id": "q_33" },
            { "text": "L'autovettura √® un veicolo destinato al trasporto di massimo nove persone, compreso il conducente", "isTrue": true, "figureId": "1", "type": "solo", "prefix": "", "highlight": "MAX 9 PERSONE compreso conducente", "id": "q_43" },
            
            // --- SEGNALI DI PERICOLO (Figure Reali) ---
            { "text": "Il segnale raffigurato preannuncia una strada deformata", "isTrue": true, "figureId": "1", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "STRADA DEFORMATA", "id": "sig_1" }, // Fig 1 is technically vehicles in text, but fig 1 in signs is deformata. Let's use specific IDs.
            { "text": "Il segnale raffigurato preannuncia un dosso", "isTrue": true, "figureId": "2", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "un DOSSO", "id": "sig_2" },
            { "text": "Il segnale raffigurato preannuncia una curva pericolosa a destra", "isTrue": true, "figureId": "3", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "CURVA A DESTRA", "id": "sig_3" },
            { "text": "Il segnale raffigurato preannuncia una curva pericolosa a sinistra", "isTrue": true, "figureId": "4", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "CURVA A SINISTRA", "id": "sig_4" },
            { "text": "Il segnale raffigurato preannuncia un passaggio a livello senza barriere", "isTrue": true, "figureId": "11", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "PASSAGGIO A LIVELLO SENZA BARRIERE", "id": "sig_11" },
            { "text": "Il segnale raffigurato preannuncia materiale instabile sulla strada", "isTrue": true, "figureId": "22", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "MATERIALE INSTABILE", "id": "sig_22" },
            { "text": "Il segnale raffigurato preannuncia la presenza di bambini", "isTrue": true, "figureId": "24", "type": "cluster", "prefix": "Il segnale raffigurato preannuncia", "highlight": "presenza di BAMBINI", "id": "sig_24" },
            
            // --- SEGNALI DI PRECEDENZA (Figure Reali) ---
            { "text": "Il segnale raffigurato obbliga a dare la precedenza", "isTrue": true, "figureId": "36", "type": "cluster", "prefix": "Il segnale raffigurato", "highlight": "DARE PRECEDENZA", "id": "sig_36" },
            { "text": "Il segnale raffigurato obbliga a fermarsi e dare la precedenza (STOP)", "isTrue": true, "figureId": "37", "type": "cluster", "prefix": "Il segnale raffigurato obbliga", "highlight": "FERMARSI E DARE PRECEDENZA", "id": "sig_37" },
            { "text": "Il segnale raffigurato indica l'intersezione con precedenza a destra", "isTrue": true, "figureId": "40", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "PRECEDENZA A DESTRA", "id": "sig_40" },
            { "text": "Il segnale raffigurato indica il diritto di precedenza", "isTrue": true, "figureId": "43", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "DIRITTO DI PRECEDENZA", "id": "sig_43" },
            
            // --- SEGNALI DI DIVIETO (Figure Reali) ---
            { "text": "Il segnale raffigurato vieta il transito a tutti i veicoli", "isTrue": true, "figureId": "46", "type": "cluster", "prefix": "Il segnale raffigurato vieta", "highlight": "DIVIETO DI TRANSITO", "id": "sig_46" },
            { "text": "Il segnale raffigurato vieta il sorpasso", "isTrue": true, "figureId": "54", "type": "cluster", "prefix": "Il segnale raffigurato vieta", "highlight": "DIVIETO DI SORPASSO", "id": "sig_54" },
            { "text": "Il segnale raffigurato indica il limite massimo di velocit√† 50 km/h", "isTrue": true, "figureId": "61", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "LIMITE MAX 50 km/h", "id": "sig_61" },
            { "text": "Il segnale raffigurato vieta la sosta", "isTrue": true, "figureId": "76", "type": "cluster", "prefix": "Il segnale raffigurato vieta", "highlight": "DIVIETO DI SOSTA", "id": "sig_76" },
            { "text": "Il segnale raffigurato indica un passo carrabile", "isTrue": true, "figureId": "78", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "PASSO CARRABILE", "id": "sig_78" },

            // --- SEGNALI DI OBBLIGO (Figure Reali) ---
            { "text": "Il segnale raffigurato indica direzione obbligatoria a destra", "isTrue": true, "figureId": "80", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "DIREZIONE OBBLIGATORIA DESTRA", "id": "sig_80" },
            { "text": "Il segnale raffigurato indica una rotatoria", "isTrue": true, "figureId": "84", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "ROTATORIA", "id": "sig_84" },
            { "text": "Il segnale raffigurato indica un percorso pedonale", "isTrue": true, "figureId": "88", "type": "cluster", "prefix": "Il segnale raffigurato indica", "highlight": "PERCORSO PEDONALE", "id": "sig_88" },
            
            // --- TRAPPOLE E FALSI (Misti) ---
            { "text": "Il segnale raffigurato (STOP) permette di passare se non c'√® nessuno", "isTrue": false, "figureId": "37", "type": "cluster", "prefix": "Il segnale raffigurato", "highlight": "passare se non c'√® nessuno", "id": "tr_1" },
            { "text": "Il segnale raffigurato (Divieto Sosta) vieta la fermata", "isTrue": false, "figureId": "76", "type": "cluster", "prefix": "Il segnale raffigurato", "highlight": "VIETA LA FERMATA", "id": "tr_2" },
            { "text": "Il segnale raffigurato (Bambini) indica una scuola", "isTrue": false, "figureId": "24", "type": "cluster", "prefix": "Il segnale raffigurato", "highlight": "indica una SCUOLA", "id": "tr_3" },
            { "text": "Il segnale raffigurato (Passo Carrabile) consente la sosta breve", "isTrue": false, "figureId": "78", "type": "cluster", "prefix": "Il segnale raffigurato", "highlight": "consente SOSTA BREVE", "id": "tr_4" },
            { "text": "I quadricicli non leggeri possono circolare in autostrada", "isTrue": false, "figureId": "1", "type": "solo", "prefix": "", "highlight": "QUADRICICLI in AUTOSTRADA", "id": "tr_5" },
            { "text": "Il limite di velocit√† per i ciclomotori √® 50 km/h", "isTrue": false, "figureId": "1", "type": "solo", "prefix": "", "highlight": "CICLOMOTORI 50 km/h", "id": "tr_6" }
        ];

        // --- GAME STATE ---
        let currentPool = [];
        let currentQuestion = null;
        let score = 0;
        let lives = 3;
        let combo = 0;
        let count = 0;

        // --- CORE LOGIC ---

        function startGame(mode) {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('card').classList.remove('hidden');
            document.getElementById('card').classList.add('flex');
            document.getElementById('controls').classList.remove('hidden');
            document.getElementById('controls').classList.add('grid');
            document.getElementById('mini-logo').classList.remove('hidden');
            
            lives = 3;
            combo = 0;
            score = 0;
            count = 0;
            updateStats();

            // Load data
            currentPool = [...database];
            currentPool.sort(() => Math.random() - 0.5);
            nextCard();
        }

        function nextCard() {
            if (currentPool.length === 0) {
                alert("Database completato! Ricarico le domande...");
                startGame('mix');
                return;
            }

            currentQuestion = currentPool.pop();
            renderCard(currentQuestion);
            
            // CRITICAL FIX: Blur active elements to remove sticky hover state on mobile
            if (document.activeElement) {
                document.activeElement.blur();
            }
        }

        function renderCard(q) {
            const card = document.getElementById('card');
            const textContainer = document.getElementById('question-text');
            const bossBadge = document.getElementById('boss-badge');
            const figBadge = document.getElementById('fig-badge');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const signContainer = document.getElementById('sign-visual-container');
            
            // Animation Reset
            card.classList.remove('card-enter', 'shake', 'boss-mode');
            void card.offsetWidth; 
            card.classList.add('card-enter');

            // Logic: Is it a difficult question?
            if (q.type === 'solo' || !q.isTrue) {
                if(Math.random() > 0.5) card.classList.add('boss-mode');
            }

            // Badge Display
            figBadge.innerText = `FIGURA ${q.figureId}`;
            bossBadge.classList.toggle('hidden', q.type !== 'solo');

            // IMAGE GENERATION (REAL URL)
            // Using a reliable public repository pattern for ministerial quiz images
            // Pattern: https://www.quizpatente.it/images/patente_b/figure/[ID].png
            // Fallback included in onerror
            signContainer.innerHTML = `
                <img src="https://www.quizpatente.it/images/patente_b/figure/${q.figureId}.png" 
                     class="ministerial-img" 
                     alt="Figura ${q.figureId}"
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/300x150?text=FIGURA+${q.figureId}';">
            `;

            // Text Logic (80/20)
            if (q.type === 'cluster' && q.prefix) {
                textContainer.innerHTML = `
                    <div class="dimmed-text">${q.prefix}...</div>
                    <div class="highlight-text">${q.highlight}</div>
                `;
            } else {
                textContainer.innerHTML = `
                    <div class="text-xl font-medium leading-snug">${q.text.replace(q.highlight, `<span class="text-yellow-400 font-bold border-b-2 border-yellow-500/50">${q.highlight}</span>`)}</div>
                `;
            }
            
            // Progress Bar
            let progress = (count % 10) * 10; 
            progressBar.style.width = `${progress}%`;
            progressText.innerText = Math.floor(count / 10) + 1;
        }

        function handleAnswer(userChoice) {
            // FIX: Immediately remove focus from button
            const btn = userChoice ? document.getElementById('btn-true') : document.getElementById('btn-false');
            btn.blur();

            const isCorrect = (userChoice === currentQuestion.isTrue);
            
            showFeedback(isCorrect);

            if (isCorrect) {
                combo++;
                count++;
                score += (10 + (combo * 2));
                if(currentQuestion.type === 'solo') score += 50;
            } else {
                combo = 0;
                lives--;
                document.getElementById('card').classList.add('shake');
            }

            updateStats();

            if (lives <= 0) {
                setTimeout(gameOver, 800);
            } else {
                setTimeout(nextCard, 500);
            }
        }

        function showFeedback(isCorrect) {
            const overlay = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            
            if (isCorrect) {
                icon.innerHTML = 'üî•';
                icon.className = 'text-9xl transform scale-0 transition-transform duration-200 drop-shadow-2xl text-green-500';
            } else {
                icon.innerHTML = 'üíÄ';
                icon.className = 'text-9xl transform scale-0 transition-transform duration-200 drop-shadow-2xl text-red-500';
            }
            
            requestAnimationFrame(() => {
                icon.classList.remove('scale-0');
                icon.classList.add('scale-150');
            });

            setTimeout(() => {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
                icon.classList.remove('scale-150');
                icon.classList.add('scale-0');
            }, 500);
        }

        function updateStats() {
            document.getElementById('combo-display').innerText = `x${combo}`;
            document.getElementById('lives-display').innerHTML = '';
            for(let i=0; i<3; i++) {
                if(i < lives) {
                    document.getElementById('lives-display').innerHTML += '<i class="fas fa-heart"></i>';
                } else {
                    document.getElementById('lives-display').innerHTML += '<i class="fas fa-heart-broken opacity-30"></i>';
                }
            }
        }

        function gameOver() {
            document.getElementById('game-over').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-count').innerText = count;
        }

        function resetGame() {
            document.getElementById('game-over').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('card').classList.add('hidden');
            document.getElementById('card').classList.remove('flex');
            document.getElementById('controls').classList.add('hidden');
            document.getElementById('controls').classList.remove('grid');
            document.getElementById('mini-logo').classList.add('hidden');
        }

    </script>
</body>
</html>
